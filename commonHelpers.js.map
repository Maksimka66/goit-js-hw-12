{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["// Імпорт axios\nimport axios from 'axios';\n\n// Імпорт izitoast\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\n// Імпорт simplelightbox\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\n//  Скрипти\nconst searchForm = document.querySelector('.form');\nconst galleryOfPictures = document.querySelector('.gallery');\nconst loader = document.querySelector('.loader');\nconst loadButton = document.querySelector('.load');\nconst lightbox = new SimpleLightbox('.gallery a', {\n  captionDelay: 250,\n  captionsData: 'alt',\n});\n\nlet page = 1;\nlet perPage = 40;\nlet searchQuery;\nlet lastPage;\nlet galleryItemHeight;\n\n// Функція запиту на сервер та параметри запиту\nasync function fetchPosts(value, page) {\n  const params = new URLSearchParams({\n    key: '41859392-e5bc4a8d4ece805d6453ecbd7',\n    q: value,\n    per_page: perPage,\n    page,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n  });\n  const response = await axios.get(`https://pixabay.com/api/?${params}`);\n  return response;\n}\n\n// Функція для створення галереї\nfunction createGallery(value) {\n  const markup = value.map(\n    ({\n      webformatURL,\n      largeImageURL,\n      tags,\n      likes,\n      views,\n      comments,\n      downloads,\n    }) => `<li class=\"gallery-item\">\n    <a  href=\"${largeImageURL}\">\n    <img \n    class=\"gallery-image\"\n    src=\"${webformatURL}\"\n    alt=\"${tags}\"\n    width=\"360\";\n    height=\"200\";\n    />\n    </a>\n    <div class=\"container\">\n    <div class=\"description\">\n    <p class=\"info\">Likes:</p>\n    <p>${likes}</p>\n    </div>\n    <div class=\"description\">\n    <p class=\"info\">Views:</p>\n    <p>${views}</p>\n    </div>\n    <div class=\"description\">\n    <p class=\"info\">Comments:</p>\n    <p>${comments}</p>\n    </div>\n    <div class=\"description\">\n    <p class=\"info\">Downloads:</p>\n    <p>${downloads}</p>\n    </div>\n    </div>\n    </li>`\n  );\n  return markup.join('');\n}\n\nfunction hasMoreData() {\n  if (page < lastPage) {\n    loadButton.style.display = 'block';\n  } else {\n    loadButton.style.display = 'none';\n    iziToast.info({\n      title: 'Info!',\n      message: `We're sorry, but you've reached the end of search results.`,\n      position: 'topRight',\n    });\n  }\n}\n\n// Слухач форми\nsearchForm.addEventListener('submit', async event => {\n  event.preventDefault();\n  galleryOfPictures.innerHTML = '';\n  loader.style.display = 'block';\n  loadButton.style.display = 'none';\n  searchQuery = searchForm.elements.delay.value.trim();\n  page = 1;\n  if (searchQuery === '') {\n    loadButton.style.display = 'none';\n    galleryOfPictures.innerHTML = '';\n    loader.style.display = 'none';\n    iziToast.warning({\n      title: 'Warning!',\n      message: 'All fields must be filled!',\n      position: 'topRight',\n    });\n    return;\n  }\n  try {\n    loader.style.display = 'block';\n    galleryOfPictures.innerHTML = '';\n    galleryOfPictures.insertAdjacentElement('beforebegin', loader);\n    const {\n      data: { hits, totalHits },\n    } = await fetchPosts(searchQuery, page);\n    if (hits.length === 0) {\n      loader.style.display = 'none';\n      loadButton.style.display = 'none';\n      iziToast.error({\n        title: 'Error!',\n        message:\n          'Sorry, there are no images matching your search query. Please try again!',\n        position: 'topRight',\n      });\n      galleryOfPictures.innerHTML = '';\n      return;\n    } else {\n      galleryOfPictures.innerHTML = createGallery(hits);\n      lightbox.refresh();\n      hasMoreData();\n      loader.style.display = 'none';\n      loadButton.style.display = 'block';\n      lastPage = Math.ceil(totalHits / perPage);\n      galleryItemHeight = document\n        .querySelector('.gallery-item:first-child')\n        .getBoundingClientRect().height;\n    }\n  } catch (error) {\n    console.error(error);\n    iziToast.error({\n      title: 'Error!',\n      message:\n        'Sorry, there are no images matching your search query. Please try again!',\n      position: 'topRight',\n    });\n    loadButton.style.display = 'none';\n  } finally {\n    loader.style.display = 'none';\n    event.target.reset();\n  }\n});\n\n//  Слухач для кнопки Load more\nloadButton.addEventListener('click', async event => {\n  page += 1;\n  loadButton.style.display = 'none';\n  try {\n    loader.style.display = 'block';\n    galleryOfPictures.insertAdjacentElement('afterend', loader);\n    const result = await fetchPosts(searchQuery, page);\n    hasMoreData();\n    const newGalleryItems = await createGallery(result.data.hits);\n    galleryOfPictures.innerHTML += newGalleryItems;\n    lightbox.refresh();\n    const newGalleryItemHeight = document\n      .querySelector('.gallery-item:last-child')\n      .getBoundingClientRect().height;\n    window.scrollBy({\n      top: newGalleryItemHeight * 2,\n      behavior: 'smooth',\n    });\n  } catch (error) {\n    console.error(error);\n    iziToast.error({\n      title: 'Error!',\n      message:\n        'Sorry, there was an error processing your request. Please try again!',\n      position: 'topRight',\n    });\n    loadButton.style.display = 'none';\n  } finally {\n    loader.style.display = 'none';\n  }\n});\n"],"names":["searchForm","galleryOfPictures","loader","loadButton","lightbox","SimpleLightbox","page","perPage","searchQuery","lastPage","galleryItemHeight","fetchPosts","value","params","axios","createGallery","webformatURL","largeImageURL","tags","likes","views","comments","downloads","hasMoreData","iziToast","event","hits","totalHits","error","result","newGalleryItems","newGalleryItemHeight"],"mappings":"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"}